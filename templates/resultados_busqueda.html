<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados de BÃºsqueda - TaskFlow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="search-header">
            <a href="{{ url_for('index') }}" class="back-link">â† Volver al inicio</a>
            <h1>ğŸ”ï¸ Resultados para: <span class="search-term">"{{ termino }}"</span></h1>
        </div>

        <div class="results-info">
            <span class="results-count">
                {% set total = tareas|length + (proyectos_resultados|length if proyectos_resultados else 0) %}
                
                {% if total == 1 %}
                    Se encontrÃ³ <strong>1</strong> coincidencia en total.
                {% else %}
                    Se encontraron <strong>{{ total }}</strong> coincidencias en total.
                {% endif %}
            </span>
        </div>

        <div class="projects-wrapper">
            {% if proyectos_resultados %}
                <h2 style="padding: 20px 40px 10px; color: #1e293b;">ğŸ“ Proyectos Coincidentes</h2>
                <div class="project-actions" style="padding: 0 40px 20px; display: flex; flex-wrap: wrap; gap: 10px; background: none; border: none;">
                    {% for p in proyectos_resultados %}
                        <a href="{{ url_for('editar_proyecto_web', proyecto_id=p._id) }}" class="project-status" style="text-decoration: none; border-color: var(--primary-color); color: var(--primary-color);">
                            {{ p._nombre }} {% if p._estado == 'Archivado' %}ğŸ”’{% endif %}
                        </a>
                    {% endfor %}
                </div>
                <hr style="border: 0; border-top: 1px solid var(--border-gray); margin: 0 40px;">
            {% endif %}

            <h2 style="padding: 20px 40px 10px; color: #1e293b;">ğŸ“ Tareas Coincidentes</h2>
            {% if tareas %}
                <ul class="task-list">
                    {% for tarea in tareas %}
                    <li class="task-item">
                        <div class="task-info">
                            <div class="task-title">
                                {{ tarea._titulo }}
                                <span class="project-badge">ğŸ“ {{ proyectos_nombres.get(tarea._proyecto_id, 'General') }}</span>
                            </div>
                            {% if tarea._descripcion %}
                            <div class="task-description">{{ tarea._descripcion }}</div>
                            {% endif %}
                            <div class="task-meta">
                                <span class="deadline">LÃ­mite: {{ tarea._fecha_limite }} | Estado: {{ tarea._estado }}</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            {% if tarea._estado != 'Completada' %}
                                <a href="{{ url_for('editar_tarea_web', tarea_id=tarea._id) }}" class="btn-edit">Editar</a>
                            {% else %}
                                <span class="project-status" style="background: #f1f5f9; color: #64748b; border: none; display: inline-flex;    /* Cambiar a flex para control total */
                                align-items: center;      
                                justify-content: center; 
                                gap: 6px;                
                                padding: 6px 14px;
                                line-height: 1;          
                                vertical-align: middle;">âœ” Finalizada</span>
                            {% endif %}

                            <a href="{{ url_for('eliminar_tarea', tarea_id=tarea._id) }}" class="btn-delete" onclick="return confirm('Â¿Seguro que deseas eliminar esta tarea?')">Eliminar</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="empty-state">
                    <p>No se encontraron tareas con el tÃ©rmino <span class="empty-state-term">"{{ termino }}"</span>.</p>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>