<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>TaskFlow - Tareas Pendientes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <style>
        .project-group.archived { opacity: 0.6; background-color: #f8f9fa; border: 2px dashed #ccc !important; }
    </style>
</head>
<body>
    <div class="container" style="text-align: left;">
        <h1 style="text-align: center;">ğŸ“‹ TaskFlow</h1>

        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
            <a href="{{ url_for('crear_tarea_web') }}" class="add-link" style="margin: 0; flex: 1; text-align: center;">â• Nueva Tarea</a>
            <a href="{{ url_for('crear_proyecto_web') }}" class="add-link" style="background-color: #6c757d; margin: 0; flex: 1; text-align: center;">ğŸ“ Nuevo Proyecto</a>
        </div>

        <h2>ğŸ“‚ Proyectos y Tareas</h2>
        
        {% for proyecto in proyectos %}
            <div class="project-group {% if proyecto._estado == 'Archivado' %}archived{% endif %}"
                style="margin-bottom: 30px; border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: left;">
                
                <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 10px;">
                    <h3 style="color: #007bff; margin: 0;">
                        ğŸ“ {{ proyecto._nombre }} 
                        {% if proyecto._estado == 'Archivado' %}
                            <span style="font-size: 0.5em; background: #6c757d; color: white; padding: 2px 6px; border-radius: 10px; margin-left: 10px;">ğŸ”’ BLOQUEADO</span>
                        {% else %}
                            <small style="font-size: 0.5em; color: #666; font-weight: normal;">({{ proyecto._estado }})</small>
                        {% endif %}
                    </h3>
                    
                    <div class="project-actions">
                        {% if proyecto._id != 0 %}
                            <a href="{{ url_for('editar_proyecto_web', proyecto_id=proyecto._id) }}" 
                               style="text-decoration: none; font-size: 0.8em; background-color: #ffc107; color: white; padding: 4px 8px; border-radius: 4px; margin-right: 5px;">
                               âœï¸ Editar/Reactivar
                            </a>
                            <a href="{{ url_for('eliminar_proyecto_web', proyecto_id=proyecto._id) }}" 
                               style="text-decoration: none; font-size: 0.8em; background-color: #dc3545; color: white; padding: 4px 8px; border-radius: 4px;"
                               onclick="return confirm('Â¿Seguro que deseas eliminar este proyecto y todas sus tareas?')">
                               ğŸ—‘ï¸ Eliminar
                            </a>
                        {% endif %}
                    </div>
                </div>

                {% if proyecto._descripcion %}
                    <div class="project-description" style="margin-bottom: 15px; color: #444; font-style: italic; font-size: 0.95em; border-left: 3px solid #eee; padding-left: 10px;">
                        {{ proyecto._descripcion }}
                    </div>
                {% endif %}

                <ul class="task-list" style="padding: 0; list-style: none;">
                    {% set ns = namespace(tiene_tareas=false) %}
                    {% for tarea in tareas %}
                        {% if tarea._proyecto_id == proyecto._id %}
                            {% set ns.tiene_tareas = true %}
                            <li class="task-item" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0;">
                                <div class="task-info">
                                    <div class="task-title" style="font-weight: bold;">
                                        {{ tarea._titulo }} 
                                        <span class="priority-{{ tarea._prioridad|lower }}" style="font-size: 0.8em;">
                                            ({{ tarea._prioridad }})
                                        </span>
                                    </div>
                                    {% if tarea._descripcion %}
                                        <div style="color: #555; font-size: 0.9em; margin-top: 4px; line-height: 1.4;">
                                            {{ tarea._descripcion }}
                                        </div>
                                    {% endif %}
                                    <small style="color: #888;">LÃ­mite: {{ tarea._fecha_limite }}</small>
                                </div>

                                <div class="task-actions" style="display: flex; gap: 5px; flex-shrink: 0;">
                                    {% if proyecto._estado != 'Archivado' %}
                                        <a href="{{ url_for('completar_tarea', tarea_id=tarea._id) }}" class="action-button">Completar</a>
                                    {% endif %}
                                    <a href="{{ url_for('editar_tarea_web', tarea_id=tarea._id) }}" class="action-button" style="background-color: #ffc107;">Editar</a>
                                    <a href="{{ url_for('eliminar_tarea', tarea_id=tarea._id) }}" 
                                       class="action-button" 
                                       style="background-color: #dc3545;" 
                                       onclick="return confirm('Â¿Seguro que deseas eliminar esta tarea?')">
                                       Eliminar
                                    </a>
                                </div>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if not ns.tiene_tareas %}
                        <li class="task-item" style="color: #999; font-style: italic; text-align: left; list-style: none;">
                            No hay tareas pendientes en este proyecto.
                        </li>
                    {% endif %}
                </ul>
            </div>
        {% else %}
            <p style="text-align: center;">No hay proyectos creados. Â¡Empieza creando uno!</p>
        {% endfor %}
    </div>
</body>
</html>